<div id="mqtt">
    <legend class="esps-legend">MQTT Configuration</legend>
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <div class="checkbox"><label><input type="checkbox" id="mqtt" name="mqtt"> Enable MQTT</label></div>
        </div>
    </div>
    <div class="form-group mqtt">
        <label class="control-label col-sm-2" for="mqtt_ip">Broker IP</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_ip" name="mqtt_ip" title="MQTT Broker IP."></div>
        <label class="control-label col-sm-2" for="mqtt_port">Broker Port</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_port" name="mqtt_port" title="MQTT Broker Port."></div>
    </div>
    <div class="form-group mqtt">
        <label class="control-label col-sm-2" for="mqtt_user">User</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_user" name="mqtt_user" title="MQTT Username (optional)."></div>
        <label class="control-label col-sm-2" for="mqtt_password">Password</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_password" name="mqtt_password" title="MQTT Password (optional)."></div>
    </div>
    <div class="form-group mqtt">
        <label class="control-label col-sm-2" for="mqtt_topic">Status Topic</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_topic" name="mqtt_topic" title="MQTT Status Topic. Control topic will be appended with /set."></div>
        <label class="control-label col-sm-2" for="mqtt_topicset">Set Topic</label>
        <div class="col-sm-3"><input type="text" class="form-control" id="mqtt_topicset" name="mqtt_topicset" title="MQTT Set Topic." readonly="true"></div>
    </div>
    <div class="form-group mqtt">
        <label class="control-label col-sm-2" for="mqtt_haprefix">Home Assistant Prefix</label>
        <div class="col-sm-10"><input type="text" class="form-control" id="mqtt_haprefix" name="mqtt_haprefix" title="Prefix used for Home Assistant Discovery"></div>
    </div>
    <div class="form-group mqtt">
        <div class="col-sm-offset-2 col-sm-10">
            <div class="checkbox"><label><input type="checkbox" id="mqtt_hadisco" name="mqtt_hadisco" title="Enables auto-discovery by Home Assistant."> Home Assistant Discovery</label></div>
        </div>
        <div class="col-sm-offset-2 col-sm-10">
            <div class="checkbox"><label><input type="checkbox" id="mqtt_clean" name="mqtt_clean"> Clean Session</label></div>
        </div>
    </div>
</div>

<script>

// MQTT field toggles
$('#mqtt_topic').keyup(function() {
    updateMQTTSet();
});
$('#mqtt').click(function() {
    if ($(this).is(':checked')) {
        $('.mqtt').removeClass('hidden');
    } else {
        $('.mqtt').addClass('hidden');
    }
});
$('#mqtt_hadisco').click(function() {
    if ($(this).is(':checked')) {
        $('#mqtt_haprefix').prop('disabled', false);
    } else {
        $('#mqtt_haprefix').prop('disabled', true);
    }
});

function updateMQTTSet() {
    if ( $('#mqtt_topic').val() ) {
        $('#mqtt_topicset').val( $('#mqtt_topic').val() + '/set');
    } else {
        $('#mqtt_topicset').val( '' );
    }
}


</script>